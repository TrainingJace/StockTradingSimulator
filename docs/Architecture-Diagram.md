# 🏗️ Stock Trading Simulator 架构图

## 系统整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              前端层 (Frontend)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  React + Vite + Router                                                      │
│                                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │    Pages    │  │ Components  │  │   Hooks     │  │ API Client  │       │
│  │ ─────────── │  │ ─────────── │  │ ─────────── │  │ ─────────── │       │
│  │ • Home      │  │ • Navigation│  │ • useStock  │  │ • authApi   │       │
│  │ • Auth      │  │ • StockChart│  │ • usePortfolio│ │ • stockApi  │       │
│  │ • Dashboard │  │ • BuyModal  │  │ • useUser   │  │ • tradingApi│       │
│  │ • Portfolio │  │ • SellModal │  │ • useForm   │  │ • newsApi   │       │
│  │ • Analytics │  │ • ErrorBoundary│ │ • useAsyncData│ │ • analyticsApi│    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        AuthContext                                  │   │
│  │                    (全局状态管理)                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                       │
                                   HTTP/REST API
                                       │
┌─────────────────────────────────────────────────────────────────────────────┐
│                              后端层 (Backend)                               │
├─────────────────────────────────────────────────────────────────────────────┤
│  Express.js + Node.js                                                       │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Routes Layer                                │   │
│  │  /api/auth  /api/stocks  /api/portfolio  /api/trading              │   │
│  │  /api/watchlist  /api/news  /api/analytics                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                       │                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Controllers Layer                              │   │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │
│  │ │   Auth   │ │  Stock   │ │Portfolio │ │ Trading  │ │Analytics │   │   │
│  │ │Controller│ │Controller│ │Controller│ │Controller│ │Controller│   │   │
│  │ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                       │                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                       Services Layer                                │   │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │
│  │ │   Auth   │ │  Stock   │ │Portfolio │ │ Trading  │ │Analytics │   │   │
│  │ │ Service  │ │ Service  │ │ Service  │ │ Service  │ │ Service  │   │   │
│  │ └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐                             │   │
│  │ │Watchlist │ │   News   │ │StockHistory                            │   │
│  │ │ Service  │ │ Service  │ │ Service  │                             │   │
│  │ └──────────┘ └──────────┘ └──────────┘                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                       │                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Middleware Layer                               │   │
│  │   • JWT Auth Middleware                                             │   │
│  │   • CORS Middleware                                                 │   │
│  │   • Error Handling                                                  │   │
│  │   • Request Logging                                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                       │
                                   SQL Queries
                                       │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            数据层 (Data Layer)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  MySQL Database                                                             │
│                                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │    Users    │  │   Stocks    │  │    News     │  │ Watchlists  │       │
│  │ ─────────── │  │ ─────────── │  │ ─────────── │  │ ─────────── │       │
│  │ • id        │  │ • symbol    │  │ • title     │  │ • user_id   │       │
│  │ • username  │  │ • name      │  │ • content   │  │ • symbol    │       │
│  │ • password  │  │ • sector    │  │ • sentiment │  │ • added_at  │       │
│  │ • email     │  │ • industry  │  │ • source    │  └─────────────┘       │
│  │ • sim_date  │  │ • description│ │ • pub_date  │                        │
│  └─────────────┘  └─────────────┘  └─────────────┘                        │
│                                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │ Portfolios  │  │ Positions   │  │Transactions │  │Portfolio    │       │
│  │ ─────────── │  │ ─────────── │  │ ─────────── │  │History      │       │
│  │ • user_id   │  │ • portfolio_id│ │ • user_id   │  │ ─────────── │       │
│  │ • cash_bal  │  │ • symbol    │  │ • type      │  │ • portfolio_id│      │
│  │ • total_val │  │ • shares    │  │ • symbol    │  │ • date      │       │
│  │ • total_ret │  │ • avg_cost  │  │ • shares    │  │ • total_val │       │
│  └─────────────┘  │ • current_val│ │ • price     │  │ • cash_bal  │       │
│                   │ • unrealized │  │ • total     │  │ • unreal_gain│      │
│                   └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                   Stock Real History                                │   │
│  │ ─────────────────────────────────────────────────────────────────── │   │
│  │ • symbol  • price_time  • open/high/low/close                      │   │
│  │ • change_price  • change_percent  • volume                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                       │
                                外部数据源集成
                                       │
┌─────────────────────────────────────────────────────────────────────────────┐
│                           外部API层 (External APIs)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────┐              ┌─────────────────────┐              │
│  │     Finnhub API     │              │  Alpha Vantage API  │              │
│  │ ─────────────────── │              │ ─────────────────── │              │
│  │ • 实时股票价格        │              │ • 历史股票数据        │              │
│  │ • 股票基本信息        │              │ • 公司基本面数据      │              │
│  │ • 市场新闻           │              │ • 技术指标数据        │              │
│  │ • 情感分析           │              │ • 财务报表数据        │              │
│  └─────────────────────┘              └─────────────────────┘              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 技术架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              技术栈架构                                     │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                                前端                                         │
│ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│ │   React     │  │    Vite     │  │ React Router│  │  Recharts   │        │
│ │   19.1.0    │  │   7.0.4     │  │ DOM 7.7.1   │  │   3.1.0     │        │
│ └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                                             │
│ ┌─────────────────────────────────────────────────────────────────────┐    │
│ │                        开发工具                                     │    │
│ │  ESLint 9.30.1  +  Vite Dev Server  +  Hot Module Replacement      │    │
│ └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                       │
                                   HTTP/HTTPS
                                       │
┌─────────────────────────────────────────────────────────────────────────────┐
│                                后端                                         │
│ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│ │   Node.js   │  │  Express    │  │   JWT       │  │   bcrypt    │        │
│ │             │  │   4.21.2    │  │   9.0.2     │  │   6.0.0     │        │
│ └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                                             │
│ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                         │
│ │    CORS     │  │   Finnhub   │  │   Axios     │                         │
│ │   2.8.5     │  │    2.0.7    │  │   1.6.0     │                         │
│ └─────────────┘  └─────────────┘  └─────────────┘                         │
│                                                                             │
│ ┌─────────────────────────────────────────────────────────────────────┐    │
│ │                        开发工具                                     │    │
│ │  Nodemon 3.0.1  +  dotenv 16.3.1  +  Error Handling               │    │
│ └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                       │
                                  SQL Connection
                                       │
┌─────────────────────────────────────────────────────────────────────────────┐
│                               数据库                                        │
│ ┌─────────────────────────────────────────────────────────────────────┐    │
│ │                        MySQL / MariaDB                              │    │
│ │                         mysql2 3.14.2                               │    │
│ │                      Connection Pool                                 │    │
│ └─────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│ ┌─────────────────────────────────────────────────────────────────────┐    │
│ │                        数据库特性                                    │    │
│ │  • InnoDB Engine  • 事务支持  • 外键约束  • 索引优化                  │    │
│ └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 部署架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              生产环境部署                                   │
└─────────────────────────────────────────────────────────────────────────────┘

                                   ┌─────────────┐
                                   │    Users    │
                                   │  (浏览器)    │
                                   └─────────────┘
                                          │
                                       HTTPS
                                          │
                    ┌─────────────────────────────────────────┐
                    │            Load Balancer                │
                    │              (Nginx)                   │
                    └─────────────────────────────────────────┘
                              │                    │
                          Static Files         API Requests
                              │                    │
                    ┌─────────────────┐    ┌─────────────────┐
                    │   Static Web    │    │   API Gateway   │
                    │     Server      │    │     (Nginx)     │
                    │   (Nginx/CDN)   │    └─────────────────┘
                    └─────────────────┘            │
                                                   │
                                        ┌─────────────────┐
                                        │  Backend Apps   │
                                        │   (PM2 Cluster) │
                                        │                 │
                                        │ ┌─────┐ ┌─────┐ │
                                        │ │App 1│ │App 2│ │
                                        │ └─────┘ └─────┘ │
                                        │ ┌─────┐ ┌─────┐ │
                                        │ │App 3│ │App 4│ │
                                        │ └─────┘ └─────┘ │
                                        └─────────────────┘
                                                   │
                                                   │
                                        ┌─────────────────┐
                                        │  Database Pool  │
                                        │     (MySQL)     │
                                        │                 │
                                        │ ┌─────┐ ┌─────┐ │
                                        │ │ M1  │ │ S1  │ │
                                        │ └─────┘ └─────┘ │
                                        │ ┌─────┐ ┌─────┐ │
                                        │ │ S2  │ │ S3  │ │
                                        │ └─────┘ └─────┘ │
                                        └─────────────────┘

开发环境:
- Frontend: Vite Dev Server (localhost:5173)
- Backend:  Express + Nodemon (localhost:3001)
- Database: MySQL (localhost:3306)

生产环境:
- Frontend: Nginx Static Server + CDN
- Backend:  PM2 Process Manager + Cluster Mode
- Database: MySQL Master-Slave Cluster
- Proxy:    Nginx Reverse Proxy + SSL
```
